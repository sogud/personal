---
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Sidebar from '../components/Sidebar.astro';
import BackToTop from '../components/BackToTop.astro';
import ReadingProgress from '../components/ReadingProgress.astro';
import TableOfContents from '../components/TableOfContents.astro';

type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage } = Astro.props;

// 获取文章内容以提取标题
const { headings } = await Astro.props.render?.() || { headings: [] };
---

<html lang="zh-CN">
  <head>
    <BaseHead 
      title={`${title} - Alex Chen`}
      description={description}
      type="article"
      publishedTime={pubDate.toISOString()}
      modifiedTime={updatedDate?.toISOString()}
      image={heroImage}
      tags={['技术', '编程', '前端']}
    />
  </head>
  <body>
    <ReadingProgress />
    <div class="layout">
      <Sidebar />
      <main class="main-content">
        <article class="blog-post">
          <h1>{title}</h1>
          <div class="meta">
            <time datetime={pubDate.toISOString()}>
              {pubDate.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
              })}
            </time>
            {updatedDate && (
              <span> · 更新于 
                <time datetime={updatedDate?.toISOString()}>
                  {updatedDate?.toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                  })}
                </time>
              </span>
            )}
          </div>
          <TableOfContents headings={headings} />
          <div class="content">
            <slot />
          </div>
        </article>
      </main>
    </div>
    <BackToTop />
  </body>
</html>